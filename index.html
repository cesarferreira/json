<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/parsy/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Parsy</title>
  </head>
  <body>
    <div id="app">
      <header class="header">
        <div class="header-left">
          <h1>
            <svg class="logo" viewBox="0 2 24 20" width="24" height="24" fill="none">
              <path d="M9 5H7a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h2 M15 5h2a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            Parsy
          </h1>
          <a href="https://github.com/cesarferreira/json" target="_blank" rel="noopener" class="github-link" title="View on GitHub">
            <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/></svg>
          </a>
          <div class="mode-toggle">
            <button id="editor-mode-btn" class="mode-btn active" title="Editor Mode">Editor</button>
            <button id="diff-mode-btn" class="mode-btn" title="Diff Mode">Diff</button>
          </div>
        </div>
        <div class="header-center">
          <div class="search-container">
            <input type="text" id="search-input" placeholder="Search... ( / )" />
            <span id="search-results" class="search-results"></span>
            <button id="search-prev" class="search-nav" title="Previous (Shift+Enter)">&#9650;</button>
            <button id="search-next" class="search-nav" title="Next (Enter)">&#9660;</button>
            <button id="search-clear" class="search-clear" title="Clear search">&times;</button>
          </div>
        </div>
        <div class="header-right">
          <div class="toolbar">
            <!-- Format Group -->
            <div class="btn-group">
              <button id="format-btn" title="Format JSON (f)"><svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 7V4h16v3M9 20h6M12 4v16"/></svg> Format</button>
              <button id="minify-btn" title="Minify JSON (m)"><svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 12h16M4 6h16M4 18h16"/></svg> Minify</button>
            </div>
            <div class="toolbar-divider"></div>
            <!-- Import/Export Group -->
            <div class="btn-group">
              <button id="url-btn" title="Import from URL"><svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 19V5M5 12l7-7 7 7"/></svg> Import</button>
              <button id="copy-btn" title="Copy JSON (c)"><svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg> Copy</button>
              <button id="download-btn" title="Download JSON (s)"><svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7 7 7-7"/><path d="M19 21H5"/></svg> Save</button>
              <button id="share-btn" title="Share via URL"><svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><path d="M8.59 13.51l6.83 3.98M15.41 6.51l-6.82 3.98"/></svg> Share</button>
            </div>
            <div class="toolbar-divider"></div>
            <!-- Tree Controls -->
            <div class="btn-group">
              <button id="expand-all-btn" title="Expand All (e)"><svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M7 10l5 5 5-5"/><path d="M7 5l5 5 5-5"/></svg> Expand</button>
              <button id="collapse-all-btn" title="Collapse All (w)"><svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M7 14l5-5 5 5"/><path d="M7 19l5-5 5 5"/></svg> Collapse</button>
            </div>
            <div class="toolbar-divider"></div>
            <!-- Actions -->
            <div class="btn-group">
              <button id="clear-btn" title="Clear (x)" class="btn-danger"><svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg> Clear</button>
              <button id="theme-btn" title="Toggle Theme (t)">
                <svg class="icon theme-icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
                <svg class="icon theme-icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
              </button>
            </div>
          </div>
        </div>
      </header>

      <!-- URL Import Modal -->
      <div id="url-modal" class="modal hidden">
        <div class="modal-content">
          <div class="modal-header">
            <h3>Import JSON from URL</h3>
            <button class="modal-close" id="url-modal-close">&times;</button>
          </div>
          <div class="modal-body">
            <input type="url" id="url-input" placeholder="https://api.example.com/data.json" />
            <button id="url-fetch-btn">Fetch</button>
          </div>
          <div id="url-error" class="modal-error hidden"></div>
        </div>
      </div>

      <!-- JSONPath Display -->
      <div id="path-display" class="path-display hidden">
        <span id="path-text"></span>
        <button id="path-copy" title="Copy path">Copy</button>
      </div>

      <!-- Editor Mode -->
      <main id="editor-view" class="main">
        <div class="pane left-pane">
          <div class="pane-header">
            <span>Input <span id="format-badge" class="format-badge">JSON</span></span>
            <span id="status" class="status"></span>
          </div>
          <div class="editor-container">
            <div id="line-numbers" class="line-numbers"></div>
            <div class="editor-wrapper">
              <textarea id="json-input" placeholder="Paste your JSON or YAML here..." spellcheck="false"></textarea>
              <pre id="syntax-highlight" class="syntax-highlight"></pre>
            </div>
          </div>
        </div>
        <div class="resizer" id="resizer"></div>
        <div class="pane right-pane">
          <div class="pane-header">
            <div class="view-toggle">
              <button id="tree-view-btn" class="view-btn active" title="Tree View (v)">
                <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3h7v7H3zM14 3h7v7h-7zM3 14h7v7H3z"/></svg>
                Tree
              </button>
              <button id="column-view-btn" class="view-btn" title="Column View (v)">
                <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3h5v18H3zM10 3h5v18h-5zM17 3h4v18h-4z"/></svg>
                Columns
              </button>
            </div>
            <span id="stats" class="stats"></span>
          </div>
          <div id="json-tree" class="json-tree"></div>
          <div id="column-view" class="column-view hidden"></div>
        </div>
      </main>

      <!-- Diff Mode -->
      <main id="diff-view" class="main hidden">
        <div class="pane diff-pane">
          <div class="pane-header">
            <span>Original JSON</span>
            <span id="diff-status-left" class="status"></span>
          </div>
          <div class="editor-container">
            <div id="diff-line-numbers-left" class="line-numbers"></div>
            <div class="editor-wrapper">
              <textarea id="diff-input-left" placeholder="Paste original JSON here..." spellcheck="false"></textarea>
              <pre id="diff-highlight-left" class="syntax-highlight"></pre>
            </div>
          </div>
        </div>
        <div class="pane diff-pane">
          <div class="pane-header">
            <span>Modified JSON</span>
            <span id="diff-status-right" class="status"></span>
          </div>
          <div class="editor-container">
            <div id="diff-line-numbers-right" class="line-numbers"></div>
            <div class="editor-wrapper">
              <textarea id="diff-input-right" placeholder="Paste modified JSON here..." spellcheck="false"></textarea>
              <pre id="diff-highlight-right" class="syntax-highlight"></pre>
            </div>
          </div>
        </div>
        <div class="pane diff-result-pane">
          <div class="pane-header">
            <span>Differences</span>
            <span id="diff-stats" class="stats"></span>
          </div>
          <div id="diff-result" class="diff-result"></div>
        </div>
      </main>

      <!-- Keyboard Shortcuts Modal -->
      <div id="shortcuts-modal" class="modal hidden">
        <div class="modal-content shortcuts-content">
          <div class="modal-header">
            <h3>Keyboard Shortcuts</h3>
            <button class="modal-close" id="shortcuts-modal-close">&times;</button>
          </div>
          <div class="modal-body shortcuts-body">
            <p class="shortcuts-note">Press keys when not typing in editor</p>
            <div class="shortcut-row"><kbd>f</kbd><span>Format JSON</span></div>
            <div class="shortcut-row"><kbd>m</kbd><span>Minify JSON</span></div>
            <div class="shortcut-row"><kbd>c</kbd><span>Copy JSON</span></div>
            <div class="shortcut-row"><kbd>s</kbd><span>Save/Download</span></div>
            <div class="shortcut-row"><kbd>e</kbd><span>Expand All</span></div>
            <div class="shortcut-row"><kbd>w</kbd><span>Collapse All</span></div>
            <div class="shortcut-row"><kbd>/</kbd><span>Search</span></div>
            <div class="shortcut-row"><kbd>t</kbd><span>Toggle Theme</span></div>
            <div class="shortcut-row"><kbd>d</kbd><span>Toggle Diff Mode</span></div>
            <div class="shortcut-row"><kbd>v</kbd><span>Toggle Tree/Column View</span></div>
            <div class="shortcut-row"><kbd>x</kbd><span>Clear</span></div>
            <div class="shortcut-row"><kbd>a</kbd><span>Private AI (offline)</span></div>
            <div class="shortcut-row"><kbd>Esc</kbd><span>Close / Unfocus</span></div>
            <div class="shortcut-row"><kbd>?</kbd><span>Show Shortcuts</span></div>
            <div id="ai-requirements" class="ai-requirements hidden">
              <div class="ai-requirements-title">Private AI Requirements:</div>
              <ul class="ai-req-list">
                <li id="ai-req-chrome"><span class="ai-req-status"></span><strong>Google Chrome 138+</strong> (not Arc, Brave, Edge)</li>
                <li id="ai-req-model"><span class="ai-req-status"></span>Enable <code class="ai-req-link" data-url="chrome://flags/#optimization-guide-on-device-model">chrome://flags/#optimization-guide-on-device-model</code></li>
                <li id="ai-req-prompt-api"><span class="ai-req-status"></span>Enable <code class="ai-req-link" data-url="chrome://flags/#prompt-api-for-gemini-nano-multimodal-input">chrome://flags/#prompt-api-for-gemini-nano-multimodal-input</code></li>
                <li id="ai-req-restart"><span class="ai-req-status"></span>Restart browser after enabling flags</li>
              </ul>
              <p class="ai-req-note">Requires 22GB storage, 4GB+ VRAM (or 16GB RAM)</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Floating AI Button -->
      <div id="ai-fab" class="ai-fab">
        <div class="ai-fab-glow"></div>
        <button id="ai-btn" class="ai-fab-btn" title="Private AI - runs offline (a)">
          Chat <code class="offline">offline</code> with <code>gemini-nano</code> about your JSON
        </button>
      </div>

      <!-- AI Chat Panel -->
      <div id="ai-panel" class="ai-panel hidden">
        <div class="ai-panel-header">
          <span>Private AI <span class="ai-offline-badge">offline</span> <code class="ai-model-name">gemini-nano</code></span>
          <button id="ai-panel-close" class="ai-panel-close" title="Minimize">
            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 15l-6-6-6 6"/></svg>
          </button>
        </div>
        <div id="ai-messages" class="ai-messages">
          <div class="ai-message ai-message-system">
            Ask me anything about your JSON. This AI runs entirely on your device - your data never leaves your browser.
          </div>
        </div>
        <div id="ai-unavailable" class="ai-unavailable hidden">
          <p>Chrome's built-in AI is not available.</p>
          <p>Requirements:</p>
          <ul>
            <li>Google Chrome 138+ (not Arc/Brave/Edge)</li>
            <li>Enable: <code>chrome://flags/#optimization-guide-on-device-model</code></li>
            <li>Enable: <code>chrome://flags/#prompt-api-for-gemini-nano-multimodal-input</code></li>
            <li>22GB storage, 4GB+ VRAM (or 16GB RAM)</li>
          </ul>
        </div>
        <div class="ai-input-container">
          <input type="text" id="ai-input" placeholder="Ask about your JSON..." />
          <button id="ai-send" title="Send">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/></svg>
          </button>
        </div>
      </div>

      <!-- Toast Notification -->
      <div id="toast" class="toast hidden"></div>

      <!-- Help Button -->
      <button id="help-btn" class="help-btn" title="Keyboard Shortcuts (?)">?</button>
    </div>
    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
