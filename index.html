<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/json/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JSON Parser</title>
  </head>
  <body>
    <div id="app">
      <header class="header">
        <div class="header-left">
          <h1>JSON Parser</h1>
          <div class="mode-toggle">
            <button id="editor-mode-btn" class="mode-btn active" title="Editor Mode">Editor</button>
            <button id="diff-mode-btn" class="mode-btn" title="Diff Mode">Diff</button>
          </div>
        </div>
        <div class="header-center">
          <div class="search-container">
            <input type="text" id="search-input" placeholder="Search... ( / )" />
            <span id="search-results" class="search-results"></span>
            <button id="search-prev" class="search-nav" title="Previous (Shift+Enter)">&#9650;</button>
            <button id="search-next" class="search-nav" title="Next (Enter)">&#9660;</button>
            <button id="search-clear" class="search-clear" title="Clear search">&times;</button>
          </div>
        </div>
        <div class="header-right">
          <div class="toolbar">
            <!-- Format Group -->
            <div class="btn-group">
              <button id="format-btn" title="Format JSON (f)"><svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 7V4h16v3M9 20h6M12 4v16"/></svg> Format</button>
              <button id="minify-btn" title="Minify JSON (m)"><svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 12h16M4 6h16M4 18h16"/></svg> Minify</button>
            </div>
            <div class="toolbar-divider"></div>
            <!-- Import/Export Group -->
            <div class="btn-group">
              <button id="url-btn" title="Import from URL"><svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 19V5M5 12l7-7 7 7"/></svg> Import</button>
              <button id="copy-btn" title="Copy JSON (c)"><svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg> Copy</button>
              <button id="download-btn" title="Download JSON (s)"><svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12l7 7 7-7"/><path d="M19 21H5"/></svg> Save</button>
              <button id="share-btn" title="Share via URL"><svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><path d="M8.59 13.51l6.83 3.98M15.41 6.51l-6.82 3.98"/></svg> Share</button>
            </div>
            <div class="toolbar-divider"></div>
            <!-- Tree Controls -->
            <div class="btn-group">
              <button id="expand-all-btn" title="Expand All (e)"><svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M7 10l5 5 5-5"/><path d="M7 5l5 5 5-5"/></svg> Expand</button>
              <button id="collapse-all-btn" title="Collapse All (w)"><svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M7 14l5-5 5 5"/><path d="M7 19l5-5 5 5"/></svg> Collapse</button>
            </div>
            <div class="toolbar-divider"></div>
            <!-- AI Assistant -->
            <div class="btn-group">
              <button id="ai-btn" title="Ask AI about JSON (a)"><svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2a2 2 0 012 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 017 7h1a1 1 0 011 1v3a1 1 0 01-1 1h-1v1a2 2 0 01-2 2H5a2 2 0 01-2-2v-1H2a1 1 0 01-1-1v-3a1 1 0 011-1h1a7 7 0 017-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 012-2M7.5 13A1.5 1.5 0 006 14.5 1.5 1.5 0 007.5 16 1.5 1.5 0 009 14.5 1.5 1.5 0 007.5 13m9 0a1.5 1.5 0 00-1.5 1.5 1.5 1.5 0 001.5 1.5 1.5 1.5 0 001.5-1.5 1.5 1.5 0 00-1.5-1.5"/></svg> AI</button>
            </div>
            <div class="toolbar-divider"></div>
            <!-- Actions -->
            <div class="btn-group">
              <button id="clear-btn" title="Clear (x)" class="btn-danger"><svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg> Clear</button>
              <button id="theme-btn" title="Toggle Theme (t)">
                <svg class="icon theme-icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
                <svg class="icon theme-icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
              </button>
            </div>
          </div>
        </div>
      </header>

      <!-- URL Import Modal -->
      <div id="url-modal" class="modal hidden">
        <div class="modal-content">
          <div class="modal-header">
            <h3>Import JSON from URL</h3>
            <button class="modal-close" id="url-modal-close">&times;</button>
          </div>
          <div class="modal-body">
            <input type="url" id="url-input" placeholder="https://api.example.com/data.json" />
            <button id="url-fetch-btn">Fetch</button>
          </div>
          <div id="url-error" class="modal-error hidden"></div>
        </div>
      </div>

      <!-- JSONPath Display -->
      <div id="path-display" class="path-display hidden">
        <span id="path-text"></span>
        <button id="path-copy" title="Copy path">Copy</button>
      </div>

      <!-- Editor Mode -->
      <main id="editor-view" class="main">
        <div class="pane left-pane">
          <div class="pane-header">
            <span>Input JSON</span>
            <span id="status" class="status"></span>
          </div>
          <div class="editor-container">
            <div id="line-numbers" class="line-numbers"></div>
            <div class="editor-wrapper">
              <textarea id="json-input" placeholder="Paste your JSON here..." spellcheck="false"></textarea>
              <pre id="syntax-highlight" class="syntax-highlight"></pre>
            </div>
          </div>
        </div>
        <div class="resizer" id="resizer"></div>
        <div class="pane right-pane">
          <div class="pane-header">
            <span>Tree View</span>
            <span id="stats" class="stats"></span>
          </div>
          <div id="json-tree" class="json-tree"></div>
        </div>
      </main>

      <!-- Diff Mode -->
      <main id="diff-view" class="main hidden">
        <div class="pane diff-pane">
          <div class="pane-header">
            <span>Original JSON</span>
            <span id="diff-status-left" class="status"></span>
          </div>
          <div class="editor-container">
            <div id="diff-line-numbers-left" class="line-numbers"></div>
            <div class="editor-wrapper">
              <textarea id="diff-input-left" placeholder="Paste original JSON here..." spellcheck="false"></textarea>
              <pre id="diff-highlight-left" class="syntax-highlight"></pre>
            </div>
          </div>
        </div>
        <div class="pane diff-pane">
          <div class="pane-header">
            <span>Modified JSON</span>
            <span id="diff-status-right" class="status"></span>
          </div>
          <div class="editor-container">
            <div id="diff-line-numbers-right" class="line-numbers"></div>
            <div class="editor-wrapper">
              <textarea id="diff-input-right" placeholder="Paste modified JSON here..." spellcheck="false"></textarea>
              <pre id="diff-highlight-right" class="syntax-highlight"></pre>
            </div>
          </div>
        </div>
        <div class="pane diff-result-pane">
          <div class="pane-header">
            <span>Differences</span>
            <span id="diff-stats" class="stats"></span>
          </div>
          <div id="diff-result" class="diff-result"></div>
        </div>
      </main>

      <!-- Keyboard Shortcuts Modal -->
      <div id="shortcuts-modal" class="modal hidden">
        <div class="modal-content shortcuts-content">
          <div class="modal-header">
            <h3>Keyboard Shortcuts</h3>
            <button class="modal-close" id="shortcuts-modal-close">&times;</button>
          </div>
          <div class="modal-body shortcuts-body">
            <p class="shortcuts-note">Press keys when not typing in editor</p>
            <div class="shortcut-row"><kbd>f</kbd><span>Format JSON</span></div>
            <div class="shortcut-row"><kbd>m</kbd><span>Minify JSON</span></div>
            <div class="shortcut-row"><kbd>c</kbd><span>Copy JSON</span></div>
            <div class="shortcut-row"><kbd>s</kbd><span>Save/Download</span></div>
            <div class="shortcut-row"><kbd>e</kbd><span>Expand All</span></div>
            <div class="shortcut-row"><kbd>w</kbd><span>Collapse All</span></div>
            <div class="shortcut-row"><kbd>/</kbd><span>Search</span></div>
            <div class="shortcut-row"><kbd>t</kbd><span>Toggle Theme</span></div>
            <div class="shortcut-row"><kbd>d</kbd><span>Toggle Diff Mode</span></div>
            <div class="shortcut-row"><kbd>x</kbd><span>Clear</span></div>
            <div class="shortcut-row"><kbd>a</kbd><span>AI Assistant</span></div>
            <div class="shortcut-row"><kbd>Esc</kbd><span>Close / Unfocus</span></div>
            <div class="shortcut-row"><kbd>?</kbd><span>Show Shortcuts</span></div>
            <div id="ai-requirements" class="ai-requirements hidden">
              <div class="ai-requirements-title">AI Assistant Requirements:</div>
              <ul class="ai-req-list">
                <li id="ai-req-chrome"><span class="ai-req-status"></span>Chrome 127 or later</li>
                <li id="ai-req-prompt-api"><span class="ai-req-status"></span>Enable <code class="ai-req-link" data-url="chrome://flags/#prompt-api-for-gemini-nano">chrome://flags/#prompt-api-for-gemini-nano</code></li>
                <li id="ai-req-model"><span class="ai-req-status"></span>Enable <code class="ai-req-link" data-url="chrome://flags/#optimization-guide-on-device-model">chrome://flags/#optimization-guide-on-device-model</code></li>
                <li id="ai-req-restart"><span class="ai-req-status"></span>Restart Chrome after enabling flags</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- AI Chat Panel -->
      <div id="ai-panel" class="ai-panel hidden">
        <div class="ai-panel-header">
          <span>AI Assistant</span>
          <button id="ai-panel-close" class="ai-panel-close">&times;</button>
        </div>
        <div id="ai-messages" class="ai-messages">
          <div class="ai-message ai-message-system">
            Ask me anything about your JSON data. I can help you understand the structure, find values, or explain what the data represents.
          </div>
        </div>
        <div id="ai-unavailable" class="ai-unavailable hidden">
          <p>Chrome's built-in AI is not available.</p>
          <p>Requirements:</p>
          <ul>
            <li>Chrome 127 or later</li>
            <li>Enable: <code>chrome://flags/#prompt-api-for-gemini-nano</code></li>
            <li>Enable: <code>chrome://flags/#optimization-guide-on-device-model</code></li>
          </ul>
        </div>
        <div class="ai-input-container">
          <input type="text" id="ai-input" placeholder="Ask about your JSON..." />
          <button id="ai-send" title="Send">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/></svg>
          </button>
        </div>
      </div>

      <!-- Toast Notification -->
      <div id="toast" class="toast hidden"></div>

      <!-- Help Button -->
      <button id="help-btn" class="help-btn" title="Keyboard Shortcuts (?)">?</button>
    </div>
    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
